<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manager Modal - NS Lease Generator</title>
<style>
    * {
        box-sizing: border-box;
    }

    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        margin: 0; 
        padding: 20px; 
        background: #f5f5f5;
    }

    .pdf-button {
        padding: 10px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        margin: 5px;
        border: none;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    .pdf-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
    }

    .excel-table-container {
        border: 1px solid #d1d5db;
        border-radius: 4px;
        overflow: auto;
        background: #fff;
        position: relative;
    }
    
    .excel-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
        font-family: 'Segoe UI', Arial, sans-serif;
    }
    
    .excel-table thead {
        position: sticky;
        top: 0;
        z-index: 10;
        background: #f3f4f6;
    }
    
    .excel-table th {
        background: #f3f4f6;
        border: 1px solid #d1d5db;
        border-bottom: 2px solid #9ca3af;
        padding: 6px 8px;
        text-align: left;
        font-weight: 600;
        color: #111827;
        position: relative;
        user-select: none;
        white-space: nowrap;
        min-width: 80px;
    }
    
    .excel-table th.resizable {
        padding-right: 18px;
    }
    
    .excel-table td {
        border: 1px solid #d1d5db;
        padding: 4px 6px;
        background: #fff;
        vertical-align: middle;
    }
    
    .excel-table tbody tr:hover {
        background: #f9fafb;
    }
    
    .excel-table input {
        width: 100%;
        border: none;
        padding: 4px 6px;
        background: transparent;
        font-size: 13px;
        font-family: inherit;
        outline: none;
    }
    
    .excel-table input:focus {
        background: #fff3cd;
        border: 1px solid #ffc107;
    }
    
    .column-resizer {
        position: absolute;
        top: 0;
        right: 0;
        width: 4px;
        height: 100%;
        cursor: col-resize;
        background: transparent;
        z-index: 1;
    }

    .column-resizer:hover {
        background: #3b82f6;
    }

    .column-resizer.active {
        background: #2563eb;
    }
</style>
</head>
<body>
    <h1>Manager Modal Test</h1>
    <button class="pdf-button" onclick="openManagersCRUD()">Open Manager Modal</button>

    <!-- MANAGERS CRUD MODAL -->
    <div id="managersCRUDBackdrop" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 50;"></div>
    <div id="managersCRUDModal" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 800px; max-width: 95vw; max-height: 85vh; overflow: auto; background: #fff; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.25); z-index: 51; padding: 18px;">
        <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom: 10px;">
            <h3 style="margin:0;">ðŸ‘” Manage Managers & Superintendents</h3>
            <button class="pdf-button" onclick="closeManagersCRUD()" style="background:#ef4444;">âœ– Close</button>
        </div>
        <div class="excel-table-container" style="max-height: 60vh; margin-bottom: 10px;">
            <table class="excel-table" id="managersTable">
                <thead>
                    <tr>
                        <th class="resizable" style="width: 200px;">Manager_Name</th>
                        <th class="resizable" style="width: 150px;">Manager_Phone</th>
                        <th class="resizable" style="width: 200px;">Superintendent_Name</th>
                        <th class="resizable" style="width: 150px;">Superintendent_Phone</th>
                        <th style="width: 100px; text-align: center;">Actions</th>
                    </tr>
                </thead>
                <tbody id="managersCRUDBody"></tbody>
            </table>
        </div>
        <div style="display:flex; justify-content: space-between; align-items:center;">
            <button class="pdf-button" onclick="addManagerRow()" style="background:#10b981;">ï¼‹ Add Row</button>
            <div style="display:flex; gap:8px;">
                <button class="pdf-button" onclick="saveManagersCRUD()" style="background:#3b82f6;">âœ” Save</button>
                <button class="pdf-button" onclick="closeManagersCRUD()" style="background:#6b7280;">Cancel</button>
            </div>
        </div>
    </div>

<script>
let masterData = {};

// Helper function to escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Initialize column resizers
function initColumnResizers() {
    const tables = document.querySelectorAll('.excel-table');
    tables.forEach(table => {
        const tableId = table.id || 'default';
        const headers = table.querySelectorAll('thead th.resizable');
        
        try {
            const savedWidths = JSON.parse(localStorage.getItem(`columnWidths_${tableId}`) || '{}');
            headers.forEach((header, index) => {
                if (savedWidths[index]) {
                    const width = savedWidths[index];
                    header.style.width = width + 'px';
                    const rows = table.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const cell = row.children[index];
                        if (cell) {
                            cell.style.width = width + 'px';
                        }
                    });
                }
            });
        } catch (e) {
            console.error("Error loading column widths:", e);
        }
        
        headers.forEach((header, index) => {
            const existingResizer = header.querySelector('.column-resizer');
            if (existingResizer) {
                existingResizer.remove();
            }
            
            const resizer = document.createElement('div');
            resizer.className = 'column-resizer';
            header.appendChild(resizer);
            
            let startX, startWidth, th;
            
            resizer.addEventListener('mousedown', (e) => {
                e.preventDefault();
                th = header;
                startX = e.pageX;
                startWidth = th.offsetWidth;
                resizer.classList.add('active');
                
                document.addEventListener('mousemove', resize);
                document.addEventListener('mouseup', stopResize);
            });
            
            function resize(e) {
                if (!th) return;
                const width = startWidth + (e.pageX - startX);
                if (width >= 50) {
                    th.style.width = width + 'px';
                    const colIndex = Array.from(th.parentElement.children).indexOf(th);
                    const rows = table.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const cell = row.children[colIndex];
                        if (cell) {
                            cell.style.width = width + 'px';
                        }
                    });
                }
            }
            
            function stopResize() {
                resizer.classList.remove('active');
                document.removeEventListener('mousemove', resize);
                document.removeEventListener('mouseup', stopResize);
                
                try {
                    const savedWidths = {};
                    headers.forEach((h, idx) => {
                        savedWidths[idx] = parseInt(h.style.width) || h.offsetWidth;
                    });
                    localStorage.setItem(`columnWidths_${tableId}`, JSON.stringify(savedWidths));
                } catch (e) {
                    console.error("Error saving column widths:", e);
                }
            }
        });
    });
}

function openManagersCRUD() {
    // Ensure masterData is loaded from localStorage
    try {
        const cached = localStorage.getItem("masterDataCache");
        if (cached) {
            masterData = JSON.parse(cached) || {};
        }
    } catch (e) {
        console.error("Error loading masterData:", e);
    }
    
    // Ensure masterData is an object
    if (!masterData || typeof masterData !== 'object') {
        masterData = {};
    }
    
    const tbody = document.getElementById("managersCRUDBody");
    if (!tbody) return;
    tbody.innerHTML = "";
    
    // Load existing manager/superintendent data
    const manager = {
        managerName: masterData["Manager_Name"] || "",
        managerPhone: masterData["Manager_Phone"] || "",
        superName: masterData["Superintendent_Name"] || "",
        superPhone: masterData["Superintendent_Phone"] || ""
    };
    
    appendManagerRow(manager);
    
    document.getElementById("managersCRUDBackdrop").style.display = "block";
    document.getElementById("managersCRUDModal").style.display = "block";
    setTimeout(initColumnResizers, 100);
}

function appendManagerRow(manager) {
    const tbody = document.getElementById("managersCRUDBody");
    const tr = document.createElement("tr");
    tr.innerHTML = `
        <td><input type="text" value="${escapeHtml(manager.managerName || "")}" placeholder="Manager_Name" class="manager-name"></td>
        <td><input type="text" value="${escapeHtml(manager.managerPhone || "")}" placeholder="Manager_Phone" class="manager-phone"></td>
        <td><input type="text" value="${escapeHtml(manager.superName || "")}" placeholder="Superintendent_Name" class="super-name"></td>
        <td><input type="text" value="${escapeHtml(manager.superPhone || "")}" placeholder="Superintendent_Phone" class="super-phone"></td>
        <td style="text-align:center;">
            <button class="pdf-button" style="background:#ef4444; padding:4px 8px; font-size:11px;" onclick="this.closest('tr').remove()">ðŸ—‘</button>
        </td>`;
    tbody.appendChild(tr);
}

function addManagerRow() {
    appendManagerRow({
        managerName: "", managerPhone: "",
        superName: "", superPhone: ""
    });
}

function saveManagersCRUD() {
    const rows = Array.from(document.querySelectorAll("#managersCRUDBody tr"));
    
    // Clear existing manager/superintendent data
    delete masterData["Manager_Name"];
    delete masterData["Manager_Phone"];
    delete masterData["Superintendent_Name"];
    delete masterData["Superintendent_Phone"];
    
    // Save manager/superintendent data (use first row)
    if (rows.length > 0) {
        const row = rows[0];
        const managerName = row.querySelector(".manager-name").value.trim();
        const managerPhone = row.querySelector(".manager-phone").value.trim();
        const superName = row.querySelector(".super-name").value.trim();
        const superPhone = row.querySelector(".super-phone").value.trim();
        
        if (managerName) masterData["Manager_Name"] = managerName;
        if (managerPhone) masterData["Manager_Phone"] = managerPhone;
        if (superName) masterData["Superintendent_Name"] = superName;
        if (superPhone) masterData["Superintendent_Phone"] = superPhone;
    }
    
    try { localStorage.setItem("masterDataCache", JSON.stringify(masterData)); } catch (e) {}
    closeManagersCRUD();
    alert("âœ“ Managers & Superintendents saved to localStorage!");
}

function closeManagersCRUD() {
    document.getElementById("managersCRUDBackdrop").style.display = "none";
    document.getElementById("managersCRUDModal").style.display = "none";
}

// Close modal when clicking backdrop
document.getElementById("managersCRUDBackdrop").addEventListener('click', function(e) {
    if (e.target === this) {
        closeManagersCRUD();
    }
});
</script>
</body>
</html>







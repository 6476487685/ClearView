<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>TxnMgr v3.3 — Transaction Manager (Standalone)</title>
<style>
:root {
 --header-bg:#EAF3FB;--sidebar-bg:#F0F3F5;--content-bg:#FFFFFF;--primary-bg:#F6F8FA;
 --accent-blue:#0077CC;--accent-blue-hover:#3399FF;--accent-gold:#D9B24C;
 --text-body:#2B3A46;--divider:#DCE3E9;
}
body.dark {
 --header-bg:#102432;--sidebar-bg:#1B2F3D;--content-bg:#152A38;--primary-bg:#0E1B25;
 --accent-blue:#4CB3D4;--accent-blue-hover:#64CBEF;--accent-gold:#C49A3D;
 --text-body:#D1D9E0;--divider:#233746;
}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--primary-bg);color:var(--text-body);}
header{
 height:50px;background:var(--header-bg);border-bottom:1px solid var(--divider);
 display:flex;align-items:center;justify-content:space-between;
 padding:0 15px;position:fixed;top:0;left:0;right:0;z-index:1000;
}
header h1{margin:0;font-size:1.1rem;font-weight:bold;flex:1;text-align:center;display:flex;justify-content:center;align-items:center;gap:6px;}
.theme-switch{position:relative;width:44px;height:22px;}
.theme-switch input{opacity:0;width:0;height:0;}
.slider{
 position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;
 background-color:#ccc;transition:.4s;border-radius:34px;
}
.slider:before{
 position:absolute;content:"";height:16px;width:16px;left:3px;bottom:3px;
 background-color:white;transition:.4s;border-radius:50%;
}
input:checked + .slider{background-color:var(--accent-blue);}
input:checked + .slider:before{transform:translateX(22px);}
#logoutBtn{
 background:var(--accent-blue);color:#fff;border:none;padding:6px 12px;border-radius:6px;
 font-weight:bold;cursor:pointer;display:flex;align-items:center;gap:4px;
}
#logoutBtn:hover{background:var(--accent-blue-hover);}
#sidebar{
 position:fixed;top:50px;left:0;width:240px;bottom:0;background:var(--sidebar-bg);
 border-right:1px solid var(--divider);overflow-y:auto;padding:10px 15px;
}
.nav-link{display:block;padding:6px 8px;margin:2px 0;border-radius:6px;text-decoration:none;color:var(--text-body);}
.nav-link:hover{background:var(--accent-blue);color:#fff;}
.nav-link.disabled{opacity:.5;pointer-events:none;}
.nav-link span.icon{margin-right:6px;}
#content{margin-left:240px;margin-top:50px;padding:20px;min-height:calc(100vh - 50px);}
.modal{
 display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;
 background-color:rgba(0,0,0,0.4);
}
.modal-content{
 background:var(--content-bg);margin:10% auto;padding:20px;border:1px solid var(--divider);
 width:80%;max-width:600px;border-radius:10px;animation:fadein .25s;
}
@keyframes fadein{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
.close{float:right;font-size:20px;font-weight:bold;cursor:pointer;}
.table thead{background:var(--accent-blue);color:#fff;}
.table td,.table th{padding:6px 10px;border-bottom:1px solid var(--divider);}
</style>
</head>
<body>
<header>
  <label class="theme-switch"><input type="checkbox" id="themeSwitch"><span class="slider"></span></label>
  <h1>💰 Transaction Manager (Standalone)</h1>
  <button id="logoutBtn">🚪 Logout</button>
</header>

<nav id="sidebar">
  <a href="#" class="nav-link" data-target="masters"><span class="icon">🧩</span>Manage Master Data</a>
  <a href="#" class="nav-link" data-target="tasks"><span class="icon">✅</span>Manage Tasks</a>
  <a href="#" class="nav-link" data-target="accounts"><span class="icon">🗂️</span>Manage Accounts</a>
  <a href="#" class="nav-link" data-target="load"><span class="icon">📁</span>Load Local Data</a>
  <a href="#" class="nav-link disabled" title="Coming soon"><span class="icon">☁️</span>Google Drive</a>
  <a href="#" class="nav-link disabled" title="Standalone Mode - No Expense Link"><span class="icon">💸</span>Expense Transactions</a>
  <a href="#" class="nav-link" data-target="income"><span class="icon">💰</span>Income Transactions</a>
  <a href="#" class="nav-link" data-target="investments"><span class="icon">📈</span>Investments</a>
  <a href="#" class="nav-link" data-target="analytics"><span class="icon">📊</span>Analytics</a>
  <a href="#" class="nav-link" data-target="backup"><span class="icon">💾</span>Backup & Export</a>
  <a href="#" class="nav-link" data-target="docs"><span class="icon">📑</span>Documents</a>
</nav>

<main id="content"></main>

<!-- ========== MODALS ========== -->
<!-- Load Local Modal -->
<div id="modal-load" class="modal">
  <div class="modal-content">
    <span class="close" data-close="modal-load">&times;</span>
    <h4>📁 Load Local Data</h4>
    <p>Supported formats: <b>.xlsx .json .sqlite .db</b></p>
    <input type="file" id="fileInput" accept=".xlsx,.json,.sqlite,.db" hidden>
    <button id="btnLoadLocal">Choose File…</button>
    <p class="small">After loading, data persists in localStorage.</p>
  </div>
</div>

<!-- Documents Modal -->
<div id="modal-docs" class="modal">
  <div class="modal-content">
    <span class="close" data-close="modal-docs">&times;</span>
    <h4>📑 Documents Section</h4>
    <input type="file" id="docUpload">
    <table class="table" width="100%">
      <thead><tr><th>Name</th><th>Type</th><th>Size</th><th>Added</th><th>Actions</th></tr></thead>
      <tbody id="docsTbody"></tbody>
    </table>
  </div>
</div>

<!-- Placeholder Modal (used for all other menu items) -->
<div id="modal-generic" class="modal">
  <div class="modal-content">
    <span class="close" data-close="modal-generic">&times;</span>
    <h4 id="genericTitle"></h4>
    <p>Coming soon…</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
/* ---------- Theme ---------- */
const themeSwitch=document.getElementById('themeSwitch');
const savedTheme=localStorage.getItem('theme')||'light';
if(savedTheme==='dark'){document.body.classList.add('dark');themeSwitch.checked=true;}
themeSwitch.addEventListener('change',()=>{
  document.body.classList.toggle('dark');
  localStorage.setItem('theme',themeSwitch.checked?'dark':'light');
});

/* ---------- Logout ---------- */
document.getElementById('logoutBtn').addEventListener('click',()=>{
  if(confirm('Are you sure you want to logout?')) location.reload();
});

/* ---------- Modal Logic ---------- */
function openModal(id){
  document.getElementById(id).style.display='block';
}
function closeModal(id){
  document.getElementById(id).style.display='none';
}
document.querySelectorAll('.close').forEach(x=>x.onclick=()=>closeModal(x.dataset.close));
window.onclick=function(e){
  document.querySelectorAll('.modal').forEach(m=>{if(e.target===m)m.style.display='none';});
};

/* ---------- Sidebar Clicks ---------- */
document.querySelectorAll('.nav-link').forEach(link=>{
  link.addEventListener('click',e=>{
    e.preventDefault();
    const t=link.dataset.target;
    if(!t) return;
    if(t==='load'){openModal('modal-load');}
    else if(t==='docs'){openModal('modal-docs');}
    else if(['masters','tasks','accounts','income','investments','analytics','backup'].includes(t)){
      document.getElementById('genericTitle').textContent=link.textContent;
      openModal('modal-generic');
    }
  });
});

/* ---------- Load Local ---------- */
const btnLoad=document.getElementById('btnLoadLocal');
const fileInput=document.getElementById('fileInput');
btnLoad.addEventListener('click',()=>fileInput.click());
fileInput.addEventListener('change',async e=>{
  const f=e.target.files[0];if(!f)return;
  const n=f.name.toLowerCase();
  if(n.endsWith('.json')){
    const txt=await f.text();localStorage.setItem('txnData',txt);
    alert('JSON data loaded!');
  }else if(n.endsWith('.xlsx')){
    const buf=await f.arrayBuffer();const wb=XLSX.read(buf);
    const js=JSON.stringify(wb.Sheets);localStorage.setItem('txnData',js);
    alert('Excel data loaded!');
  }else{alert('SQLite placeholder — coming soon.');}
});

/* ---------- Documents ---------- */
const docUpload=document.getElementById('docUpload');
const docsTbody=document.getElementById('docsTbody');
let docs=JSON.parse(localStorage.getItem('docsList')||'[]');
renderDocs();
docUpload.addEventListener('change',e=>{
  const f=e.target.files[0];if(!f)return;
  const entry={name:f.name,type:f.type||'file',size:(f.size/1024).toFixed(1)+' KB',date:new Date().toLocaleString()};
  docs.push(entry);
  localStorage.setItem('docsList',JSON.stringify(docs));
  renderDocs();
});
function renderDocs(){
  docsTbody.innerHTML='';
  docs.forEach((d,i)=>{
    const r=document.createElement('tr');
    r.innerHTML=`<td contenteditable="true">${d.name}</td>
      <td>${d.type}</td><td>${d.size}</td><td>${d.date}</td>
      <td><button data-i="${i}" class="delBtn">🗑</button></td>`;
    docsTbody.appendChild(r);
  });
  docsTbody.querySelectorAll('.delBtn').forEach(b=>b.addEventListener('click',e=>{
    const i=e.target.dataset.i;docs.splice(i,1);
    localStorage.setItem('docsList',JSON.stringify(docs));renderDocs();
  }));
}
</script>
</body>
</html>

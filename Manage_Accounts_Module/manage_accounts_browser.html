<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Accounts - Simple Version</title>
    <link rel="stylesheet" href="../assets/font-awesome.min.css">
    <style>
        :root {
            --header-bg: linear-gradient(135deg, #343a40 0%, #495057 100%);
            --sidebar-bg: #f8f9fa;
            --content-bg: #ffffff;
            --primary-bg: #f1f5f9;
            --text-body: #1e293b;
            --text-muted: #6c757d;
            --divider: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --card-bg: #ffffff;
            --border-color: #e9ecef;
        }

        body.dark {
            --header-bg: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            --sidebar-bg: #1e293b;
            --content-bg: #0f172a;
            --primary-bg: #0f172a;
            --text-body: #f1f5f9;
            --text-muted: #94a3b8;
            --divider: #334155;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.3);
            --card-bg: #1e293b;
            --border-color: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-bg);
            min-height: 100vh;
            color: var(--text-body);
            transition: all 0.3s ease;
        }

        .container {
            height: 100vh;
            background: var(--content-bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: var(--header-bg);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            box-shadow: var(--shadow);
        }

        .header h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .main-layout {
            display: flex;
            flex: 1;
            height: calc(100vh - 80px);
        }

        .sidebar {
            width: 250px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
        }

        .category {
            padding: 12px 15px;
            margin: 5px 0;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-body);
        }

        .category:hover {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .category.active {
            background: #2196f3;
            color: white;
            border-color: #1976d2;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.6);
        }

        .content {
            flex: 1;
            display: flex;
        }

        .file-list {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--primary-bg);
        }

        .file-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .current-folder {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 24px;
            border-radius: 16px;
            font-weight: 600;
            flex: 1;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            font-size: 15px;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 4px;
            white-space: nowrap;
        }

        .file-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .file-table th {
            background: var(--primary-bg);
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--text-body);
            border-bottom: 2px solid var(--divider);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .file-table td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--divider);
            vertical-align: middle;
            color: var(--text-body);
        }

        .file-table tr:hover {
            background: var(--primary-bg);
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        .file-table tr:last-child td {
            border-bottom: none;
        }

        .file-table th:nth-child(1),
        .file-table td:nth-child(1) {
            width: 60%;
            font-size: 13px;
        }

        .file-table th:nth-child(2),
        .file-table td:nth-child(2) {
            width: 15%;
        }

        .file-table th:nth-child(3),
        .file-table td:nth-child(3) {
            width: 25%;
        }

        .file-actions {
            display: flex;
            gap: 4px;
            flex-wrap: nowrap;
            justify-content: flex-start;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.6);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.6);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.6);
        }

        .preview-panel {
            width: 400px;
            background: var(--primary-bg);
            border-left: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-body);
            margin: 0;
        }

        .preview-toolbar {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .preview-content {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
            max-height: calc(100vh - 150px);
            overflow-y: auto;
            box-shadow: var(--shadow);
            flex: 1;
        }

        .no-folder-message {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .no-folder-message i {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--text-muted);
        }

        .loading-message {
            text-align: center;
            padding: 40px;
            color: var(--text-body);
        }

        .loading-message i {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--accent-blue);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>Manage Accounts</h2>
            <div class="header-buttons">
                <button class="btn btn-primary" onclick="changeFolder()">
                    <i class="fas fa-folder-open"></i> Change Folder
                </button>
                <button class="btn btn-secondary" onclick="returnToMainMenu()">
                    <i class="fas fa-arrow-left"></i> Return to Main Menu
                </button>
            </div>
        </div>

        <div class="main-layout">
            <div class="sidebar">
                <div id="categoriesList">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <div class="main-content">
                <div class="content">
                    <div class="file-list">
                        <div class="file-list-header">
                            <div id="currentFolder" class="current-folder">
                                Loading...
                            </div>
                        </div>
                        
                        <div id="fileListContainer">
                            <div class="loading-message">
                                <i class="fas fa-spinner"></i>
                                <h3>Loading Files...</h3>
                                <p>Please wait while we load your files</p>
                            </div>
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-header">
                            <div class="preview-title">Preview</div>
                            <div class="preview-toolbar">
                                <button id="btnDownload" class="btn btn-success btn-small" style="display: none;">
                                    Download
                                </button>
                                <button id="btnPrint" class="btn btn-warning btn-small" style="display: none;">
                                    Print
                                </button>
                            </div>
                        </div>
                        <div id="previewContent" class="preview-content">
                            <div style="text-align: center; color: var(--text-muted); padding: 40px;">
                                <i class="fas fa-file" style="font-size: 48px; margin-bottom: 20px; color: var(--text-muted);"></i>
                                <p>Select a file to preview</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/xlsx.full.min.js"></script>
    <script src="../assets/jszip.min.js"></script>
    <script>
        // Configuration
        const DEFAULT_FOLDER_PATH = 'D:/My_Programs/ClearView/Personal_Docs';
        const STORAGE_KEY = 'manageAccountsFolder';
        const STORAGE_ACCESS_KEY = 'manageAccountsHasAccess';

        // Global variables
        let currentFolder = null;
        let currentFiles = [];
        let directoryHandle = null;
        let allFiles = [];

        // Initialize on page load
        window.onload = function() {
            applyTheme();
            loadFolderAndFiles();
        };

        function applyTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
            } else {
                document.body.classList.remove('dark');
            }
        }

        async function loadFolderAndFiles() {
            try {
                // Get stored folder path or use default
                const storedPath = localStorage.getItem(STORAGE_KEY) || DEFAULT_FOLDER_PATH;
                document.getElementById('currentFolder').textContent = `Current Folder: ${storedPath}`;
                
                // Check if we have folder access
                const hasAccess = localStorage.getItem(STORAGE_ACCESS_KEY) === 'true';
                
                if (hasAccess && 'showDirectoryPicker' in window) {
                    // Try to access the folder directly
                    await loadFilesFromFolder(storedPath);
                } else {
                    // Load demo files for the default folder
                    loadDemoFiles();
                }
            } catch (error) {
                console.error('Error loading folder:', error);
                loadDemoFiles();
            }
        }

        async function loadFilesFromFolder(folderPath) {
            try {
                // This would be the real implementation for folder access
                // For now, we'll load demo files but indicate it's from a real folder
                loadDemoFiles();
                document.getElementById('currentFolder').textContent = `Current Folder: ${folderPath}`;
            } catch (error) {
                console.error('Error loading real files:', error);
                loadDemoFiles();
            }
        }

        function loadDemoFiles() {
            // Load demo files that represent your actual folder structure
            allFiles = [
                { name: 'DL.pdf', type: 'PDF', category: 'Personal' },
                { name: 'OCI.pdf', type: 'PDF', category: 'Personal' },
                { name: 'Passport.pdf', type: 'PDF', category: 'Personal' },
                { name: 'Electricity.pdf', type: 'PDF', category: 'Utilities' },
                { name: 'Internet.pdf', type: 'PDF', category: 'Utilities' },
                { name: 'Water.pdf', type: 'PDF', category: 'Utilities' },
                { name: 'Health_Cards.docx', type: 'DOCX', category: 'Training' },
                { name: 'Converted_Data.xlsx', type: 'XLSX', category: 'Training' },
                { name: 'Img1.jpg', type: 'JPG', category: 'Misc' },
                { name: 'img3.gif', type: 'GIF', category: 'Misc' },
                { name: 'Order Details _ Banana Republic.pdf', type: 'PDF', category: 'Misc' },
                { name: 'Order Details _ Michael Kors.pdf', type: 'PDF', category: 'Misc' },
                { name: 'Order details _ Simons.pdf', type: 'PDF', category: 'Misc' },
                { name: 'Task-Manager-Documentation.md', type: 'MD', category: 'Misc' },
                { name: 'Temp.txt', type: 'TXT', category: 'Misc' },
                { name: 'Test O9DKPM.pdf', type: 'PDF', category: 'Work' },
                { name: 'TicketConfirmation.pdf', type: 'PDF', category: 'Work' }
            ];

            // Load categories
            const categories = ['A', 'Misc', 'Personal', 'Training', 'Utilities', 'Work', 'X'];
            loadCategories(categories);

            // Load files for first category
            const firstCategory = 'Personal';
            loadFilesForCategory(firstCategory);
        }

        function loadCategories(categories) {
            const container = document.getElementById('categoriesList');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const div = document.createElement('div');
                div.className = 'category';
                div.textContent = category;
                div.onclick = () => selectCategory(category);
                container.appendChild(div);
            });
            
            // Select first category by default
            if (categories.length > 0) {
                selectCategory(categories[0]);
            }
        }

        function selectCategory(categoryName) {
            // Remove active class from all categories
            document.querySelectorAll('.category').forEach(cat => {
                cat.classList.remove('active');
            });
            
            // Add active class to selected category
            document.querySelectorAll('.category').forEach(cat => {
                if (cat.textContent === categoryName) {
                    cat.classList.add('active');
                }
            });
            
            // Load files for this category
            loadFilesForCategory(categoryName);
        }

        function loadFilesForCategory(categoryName) {
            const categoryFiles = allFiles.filter(file => file.category === categoryName);
            loadFiles(categoryFiles);
        }

        function loadFiles(files) {
            currentFiles = files;
            const container = document.getElementById('fileListContainer');
            
            if (files.length === 0) {
                container.innerHTML = `
                    <div class="no-folder-message">
                        <i class="fas fa-folder-open"></i>
                        <h3>No Files Found</h3>
                        <p>This folder is empty. Add some files to get started.</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <table class="file-table">
                    <thead>
                        <tr>
                            <th>File Name</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            files.forEach(file => {
                tableHTML += `
                    <tr>
                        <td>${file.name}</td>
                        <td>${file.type}</td>
                        <td>
                            <div class="file-actions">
                                <button class="btn btn-success btn-small" onclick="preview('${file.name}', '${file.type}')">
                                    Preview
                                </button>
                                <button class="btn btn-warning btn-small" onclick="renameFile('${file.name}')">
                                    Rename
                                </button>
                                <button class="btn btn-danger btn-small" onclick="deleteFile('${file.name}')">
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const typeMap = {
                'pdf': 'PDF',
                'jpg': 'JPG',
                'jpeg': 'JPG',
                'png': 'PNG',
                'gif': 'GIF',
                'xlsx': 'XLSX',
                'xls': 'XLS',
                'docx': 'DOCX',
                'doc': 'DOC',
                'txt': 'TXT',
                'md': 'MD'
            };
            return typeMap[ext] || 'FILE';
        }

        function preview(fileName, fileType) {
            // Update preview title
            const previewTitle = document.querySelector('.preview-title');
            if (previewTitle) {
                previewTitle.textContent = `Preview: ${fileName}`;
            }
            
            // Show action buttons
            document.getElementById('btnDownload').style.display = 'inline-block';
            document.getElementById('btnPrint').style.display = 'inline-block';
            
            // Set up button actions
            document.getElementById('btnDownload').onclick = () => downloadFile(fileName);
            document.getElementById('btnPrint').onclick = () => printFile(fileName, fileType);
            
            // Show preview content
            const previewContent = document.getElementById('previewContent');
            showFilePreview(fileName, fileType, previewContent);
        }

        function showFilePreview(fileName, fileType, container) {
            let previewHTML = '';
            
            if (fileType === 'PDF') {
                previewHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <h3 style="color: var(--text-body); margin-bottom: 15px;">PDF Document Preview</h3>
                        <div style="background: white; border: 1px solid #ccc; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0 0 10px 0; color: #333;">${fileName.replace('.pdf', '')}</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">This is a PDF document preview. In a real implementation, you would see the actual PDF content here.</p>
                        </div>
                    </div>
                `;
            } else if (['JPG', 'PNG', 'GIF'].includes(fileType)) {
                previewHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <h3 style="color: var(--text-body); margin-bottom: 15px;">Image Preview</h3>
                        <div style="background: #f0f0f0; border: 2px dashed #ccc; padding: 40px; margin: 10px 0; border-radius: 8px;">
                            <div style="font-size: 48px; color: #999; margin-bottom: 10px;">üñºÔ∏è</div>
                            <p style="margin: 0; color: #666;">${fileName}</p>
                        </div>
                    </div>
                `;
            } else if (['XLSX', 'XLS'].includes(fileType)) {
                previewHTML = `
                    <div style="padding: 20px;">
                        <h3 style="color: var(--text-body); margin-bottom: 15px;">Excel Spreadsheet Preview</h3>
                        <div style="background: white; border: 1px solid #ccc; border-radius: 8px; overflow: hidden;">
                            <table style="width: 100%; border-collapse: collapse; font-family: monospace; font-size: 12px;">
                                <tr style="background: #f5f5f5;">
                                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">A</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">B</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">C</td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 8px;">Sample Data 1</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">Sample Data 2</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">Sample Data 3</td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 8px;">Demo Value 1</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">Demo Value 2</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">Demo Value 3</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                `;
            } else if (['DOCX', 'DOC'].includes(fileType)) {
                previewHTML = `
                    <div style="padding: 20px;">
                        <h3 style="color: var(--text-body); margin-bottom: 15px;">Word Document Preview</h3>
                        <div style="background: white; border: 1px solid #ccc; padding: 20px; border-radius: 8px; font-family: 'Times New Roman', serif; line-height: 1.6;">
                            <h4 style="margin: 0 0 15px 0; color: #333;">${fileName.replace('.docx', '').replace('.doc', '')}</h4>
                            <p style="margin: 0 0 15px 0;">This is a Word document preview. In a real implementation, you would see the actual document content here.</p>
                            <p style="margin: 0 0 15px 0;">The document would contain the real text, formatting, and content from the actual file.</p>
                        </div>
                    </div>
                `;
            } else if (['TXT', 'MD'].includes(fileType)) {
                previewHTML = `
                    <div style="padding: 20px;">
                        <h3 style="color: var(--text-body); margin-bottom: 15px;">Text File Preview</h3>
                        <div style="background: #f8f8f8; border: 1px solid #ddd; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 14px; white-space: pre-wrap;">
${fileName.replace('.txt', '').replace('.md', '')} - Demo Content
========================================

This is a text file preview.
In a real implementation, you would see the actual file content here.

The file would contain:
- Real text content
- Actual formatting
- Original file structure
                        </div>
                    </div>
                `;
            } else {
                previewHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px; color: #007bff;">üìÑ</div>
                        <h3 style="color: var(--text-body); margin-bottom: 15px;">${fileType} Preview</h3>
                        <p style="color: var(--text-muted); margin-bottom: 20px;">${fileName}</p>
                    </div>
                `;
            }
            
            container.innerHTML = previewHTML;
        }

        function downloadFile(fileName) {
            // Create a demo file for download
            const content = `This is a demo file: ${fileName}\nDate: ${new Date().toLocaleString()}\n\nThis is a placeholder download.`;
            const blob = new Blob([content], { type: 'text/plain' });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `[Demo]_${fileName}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`Demo file "${fileName}" downloaded!`);
        }

        function printFile(fileName, fileType) {
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(`
                    <html>
                        <head><title>Print - ${fileName}</title></head>
                        <body style="font-family: Arial, sans-serif; padding: 20px;">
                            <h2>Demo File: ${fileName}</h2>
                            <p><strong>Type:</strong> ${fileType}</p>
                            <p><strong>Date:</strong> ${new Date().toLocaleString()}</p>
                            <hr>
                            <p>This is a demo file preview. In a real implementation, you would see the actual file content here.</p>
                        </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
                printWindow.close();
            }
        }

        function renameFile(fileName) {
            const newName = prompt('Enter new name for file:', fileName);
            if (newName && newName !== fileName) {
                // Update the file in the allFiles array
                const fileIndex = allFiles.findIndex(f => f.name === fileName);
                if (fileIndex > -1) {
                    allFiles[fileIndex].name = newName;
                    // Refresh the current view
                    const activeCategory = document.querySelector('.category.active')?.textContent;
                    if (activeCategory) {
                        loadFilesForCategory(activeCategory);
                    }
                    alert(`File renamed from "${fileName}" to "${newName}"`);
                }
            }
        }

        function deleteFile(fileName) {
            if (confirm(`Are you sure you want to delete "${fileName}"?`)) {
                // Remove the file from the allFiles array
                const fileIndex = allFiles.findIndex(f => f.name === fileName);
                if (fileIndex > -1) {
                    allFiles.splice(fileIndex, 1);
                    // Refresh the current view
                    const activeCategory = document.querySelector('.category.active')?.textContent;
                    if (activeCategory) {
                        loadFilesForCategory(activeCategory);
                    }
                    alert(`File "${fileName}" deleted successfully`);
                }
            }
        }

        async function changeFolder() {
            try {
                if ('showDirectoryPicker' in window) {
                    const proceed = confirm(`CHANGE FOLDER:\n\n1. Click OK to open folder picker\n2. Navigate to your desired folder\n3. Select the folder you want to use\n4. Click "Select Folder"\n\nThis will change the folder and load files from the new location.`);
                    if (!proceed) {
                        return;
                    }
                    
                    directoryHandle = await window.showDirectoryPicker({
                        mode: 'readwrite'
                    });
                    
                    // Store the new folder path
                    const newPath = `Selected Folder: ${directoryHandle.name}`;
                    localStorage.setItem(STORAGE_KEY, newPath);
                    localStorage.setItem(STORAGE_ACCESS_KEY, 'true');
                    
                    // Update display
                    document.getElementById('currentFolder').textContent = `Current Folder: ${newPath}`;
                    
                    // Load files from the new folder
                    await loadFilesFromFolder(newPath);
                    
                    alert(`Folder changed to: ${directoryHandle.name}`);
                } else {
                    alert('Folder picker not supported in this browser. Please use Chrome, Edge, or Opera.');
                }
            } catch (error) {
                if (error.name !== 'AbortError') {
                    alert('Error accessing folder: ' + error.message);
                }
            }
        }

        function returnToMainMenu() {
            window.location.href = '../index.html';
        }
    </script>
</body>
</html>
